CREATE TABLE IF NOT EXISTS cargo_container (
    cntr_id int4 GENERATED BY DEFAULT AS IDENTITY,
    cntr_hbl_id int4 NULL,
    cntr_mbl_id int4 NULL,
    cntr_catg varchar(20) NULL,
    cntr_no varchar(60) NULL,
    cntr_type_id int4 NULL,
    cntr_sealno varchar(30) NULL,
    cntr_movement varchar(30) NULL,
    cntr_pieces int4 NULL,
    cntr_packages_unit_id int4 NULL,
    cntr_packages int4 NULL,
    cntr_teu numeric(5, 3) NULL,
    cntr_cbm numeric(14, 3) NULL,
    cntr_weight_uom varchar(10) NULL,
    cntr_weight numeric(14, 3) NULL,
    cntr_rider varchar(60) NULL,
    cntr_tare_weight numeric(14, 3) NULL,
    cntr_pick_date date NULL,
    cntr_return_date date NULL,
    cntr_lfd date NULL,
    cntr_discharge_date date NULL,
    cntr_order int4 NOT NULL,

    rec_year int4 NOT NULL,
    rec_version int4 DEFAULT 1 NULL,
    rec_locked text NULL,
    rec_created_by varchar(20) NOT NULL,
    rec_created_date timestamptz NOT NULL,
    rec_edited_by varchar(20) NULL,
    rec_edited_date timestamptz NULL,
    rec_company_id int4 NOT NULL,
    rec_branch_id int4 NOT NULL,

    CONSTRAINT pk_cargo_container_cntr_id PRIMARY KEY (cntr_id)
);

DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_container_cntr_hbl_id') THEN
        CREATE INDEX "IX_cargo_container_cntr_hbl_id" ON cargo_container USING btree (cntr_hbl_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_container_cntr_mbl_id') THEN
        CREATE INDEX "IX_cargo_container_cntr_mbl_id" ON cargo_container USING btree (cntr_mbl_id);
    END IF;
    
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_container_cntr_type_id') THEN
        CREATE INDEX "IX_cargo_container_cntr_type_id" ON cargo_container USING btree (cntr_type_id);
    END IF;
    
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_container_cntr_packages_unit_id') THEN
        CREATE INDEX "IX_cargo_container_cntr_packages_unit_id" ON cargo_container USING btree (cntr_packages_unit_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_container_rec_company_id') THEN
        CREATE INDEX "IX_cargo_container_rec_company_id" ON cargo_container USING btree (rec_company_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_container_rec_branch_id') THEN
        CREATE INDEX "IX_cargo_container_rec_branch_id" ON cargo_container USING btree (rec_branch_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('cargo_container', 'cntr_id'),
              COALESCE(MAX(cntr_id), 1),
              true)
FROM cargo_container;