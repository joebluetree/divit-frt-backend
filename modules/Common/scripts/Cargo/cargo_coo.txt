CREATE TABLE IF NOT EXISTS cargo_coo (
    mbld_id int4 GENERATED BY DEFAULT AS IDENTITY,
    mbld_parent_id int4 NULL,
    mbld_mode varchar(20) NULL,
    mbld_exp_ref varchar(60) NULL,
    mbld_shipper_id int4 NULL,
    mbld_shipper_name varchar(100) NULL,
    mbld_shipper_add1 varchar(60) NULL,
    mbld_shipper_add2 varchar(60) NULL,
    mbld_shipper_add3 varchar(120) NULL,
    mbld_shipper_add4 varchar(120) NULL,
    mbld_consignee_id int4 NULL,
    mbld_consignee_name varchar(100) NULL,
    mbld_consignee_add1 varchar(60) NULL,
    mbld_consignee_add2 varchar(60) NULL,
    mbld_consignee_add3 varchar(120) NULL,
    mbld_consignee_add4 varchar(120) NULL,
    mbld_notify_id int4 NULL,
    mbld_notify_name varchar(100) NULL,
    mbld_notify_add1 varchar(60) NULL,
    mbld_notify_add2 varchar(60) NULL,
    mbld_notify_add3 varchar(120) NULL,
    mbld_notify_add4 varchar(120) NULL,
    mbld_agent_id int4 NULL,    
    mbld_place_receipt varchar(60) NULL,    
    mbld_pol_name varchar(60) NULL,
    mbld_pod_name varchar(60) NULL,
    mbld_place_delivery varchar(60) NULL,
    mbld_move_type varchar(60) NULL,
    mbld_is_cntrized varchar(5) NULL,
    mbld_handled_id int4 NULL,
    mbld_print_vsl_voy varchar(5) NULL,
    mbld_clean varchar(10) NULL,
    mbld_cbm NUMERIC(14, 3) NULL,
    mbld_weight NUMERIC(14, 3) NULL,
    mbld_lbs NUMERIC(14, 3) NULL,
    mbld_cft NUMERIC(14, 3) NULL,
    mbld_remark1 varchar(80) NULL,
    mbld_remark2 varchar(80) NULL,
    mbld_remark3 varchar(80) NULL,    
    mbld_print_kgs varchar(10) NULL,
    mbld_print_lbs varchar(10) NULL,

    rec_year int4 NULL,     
    rec_version int4 DEFAULT 1 NOT NULL,
    rec_locked text NULL,
    rec_created_by varchar(20) NOT NULL,
    rec_created_date timestamptz NOT NULL,
    rec_edited_by varchar(20) NULL,
    rec_edited_date timestamptz NULL,
    rec_company_id int4 NOT NULL,
    rec_branch_id int4 NOT NULL,

    CONSTRAINT pk_cargo_coo_mbld_id PRIMARY KEY (mbld_id)
);

DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_coo_mbld_parent_id') THEN
        CREATE INDEX "IX_cargo_coo_mbld_parent_id" ON cargo_coo USING btree (mbld_parent_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_coo_mbld_shipper_id') THEN
        CREATE INDEX "IX_cargo_coo_mbld_shipper_id" ON cargo_coo USING btree (mbld_shipper_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_coo_mbld_consignee_id') THEN
        CREATE INDEX "IX_cargo_coo_mbld_consignee_id" ON cargo_coo USING btree (mbld_consignee_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_coo_mbld_notify_id') THEN
        CREATE INDEX "IX_cargo_coo_mbld_notify_id" ON cargo_coo USING btree (mbld_notify_id);
    END IF;
    
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_coo_mbld_agent_id') THEN
        CREATE INDEX "IX_cargo_coo_mbld_agent_id" ON cargo_coo USING btree (mbld_agent_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_coo_mbld_handled_id') THEN
        CREATE INDEX "IX_cargo_coo_mbld_handled_id" ON cargo_coo USING btree (mbld_handled_id);
    END IF;
    
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_coo_rec_company_id') THEN
        CREATE INDEX "IX_cargo_coo_rec_company_id" ON cargo_coo USING btree (rec_company_id);
    END IF;
    
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_coo_rec_branch_id') THEN
        CREATE INDEX "IX_cargo_coo_rec_branch_id" ON cargo_coo USING btree (rec_branch_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('cargo_coo', 'mbld_id'),
              COALESCE(MAX(mbld_id), 1),
              true)
FROM cargo_coo;