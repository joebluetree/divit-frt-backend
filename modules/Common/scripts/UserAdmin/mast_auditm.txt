CREATE TABLE IF NOT EXISTS mast_logm (
    log_id int4 GENERATED BY DEFAULT AS IDENTITY,
    log_date timestamptz NOT NULL,
    log_user_code varchar(20) NOT NULL,
    log_table varchar(60) NOT NULL,
    log_table_id int4 NOT NULL,
    log_column varchar(100) NOT NULL,
    log_desc varchar(100) NOT NULL,
    log_refno varchar(100) NOT NULL,
    log_value varchar(500) NOT NULL,
    rec_company_id int4 NOT NULL,
    rec_branch_id int4 NOT NULL,
    CONSTRAINT pk_mast_logm_log_id PRIMARY KEY (log_id)
);

DO $$
BEGIN

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'uq_mast_logm_log_id') THEN
        CREATE UNIQUE INDEX uq_mast_logm_log_id ON mast_logm USING btree (log_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('mast_logm', 'log_id'), 
              COALESCE(MAX(log_id), 1), 
              true) 
FROM mast_logm;