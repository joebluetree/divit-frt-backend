CREATE TABLE IF NOT EXISTS gen_remarkm (
    remk_id int4 GENERATED BY DEFAULT AS IDENTITY,
    remk_parent_id int4 NULL,
    remk_parent_type varchar(50) NULL,
    remk_desc varchar(200) NULL,
    remk_order int4 NULL,

    rec_version int4 DEFAULT 1 NOT NULL,
    rec_locked text NULL,
    rec_created_by varchar(20) NOT NULL,
    rec_created_date timestamptz NOT NULL,
    rec_edited_by varchar(20) NULL,
    rec_edited_date timestamptz NULL,
    rec_company_id int4 NOT NULL,
    rec_branch_id INT4 NULL,

    CONSTRAINT pk_gen_remarkm_remk_id PRIMARY KEY (remk_id)
);

DO $$
BEGIN

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_gen_remarkm_rec_company_id') THEN
        CREATE INDEX "IX_gen_remarkm_rec_company_id" ON gen_remarkm USING btree (rec_company_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_gen_remarkm_rec_branch_id') THEN
        CREATE INDEX "IX_gen_remarkm_rec_branch_id" ON gen_remarkm USING btree (rec_branch_id);
    END IF;

END $$;

SELECT setval(pg_get_serial_sequence('gen_remarkm', 'remk_id'),
              COALESCE(MAX(remk_id), 1),
              true)
FROM gen_remarkm;