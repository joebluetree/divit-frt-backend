
CREATE TABLE IF NOT EXISTS tnt_trackd (
	trackd_id int4 GENERATED BY DEFAULT AS IDENTITY,
	trackd_trackm_id int4 NOT NULL,
	trackd_last_updated_on timestamp NULL,
	rec_version int4 DEFAULT 1 NOT NULL,
	rec_locked bpchar(1) DEFAULT 'N'::bpchar NOT NULL,
	rec_created_by varchar(20) NOT NULL,
	rec_created_date timestamptz NOT NULL,
	rec_edited_by varchar(20) NULL,
	rec_edited_date timestamptz NULL,
	rec_company_id int4 NOT NULL,
	CONSTRAINT pk_tnt_trackd_trackd_id PRIMARY KEY (trackd_id)
);

DO $$  
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'IX_tnt_trackd_rec_company_id') THEN
		CREATE INDEX "IX_tnt_trackd_rec_company_id" ON tnt_trackd USING btree (rec_company_id);
    END IF;
	
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'IX_tnt_trackd_trackd_trackm_id') THEN
		CREATE INDEX "IX_tnt_trackd_trackd_trackm_id" ON tnt_trackd USING btree (trackd_trackm_id);
    END IF;

END $$;

SELECT setval(pg_get_serial_sequence('tnt_trackd', 'trackd_id'), 
              COALESCE(MAX(trackd_id), 1), 
              true) 
FROM tnt_trackd;