CREATE TABLE IF NOT EXISTS mark_qtnd_fcl (
    qtnd_id int4 GENERATED BY DEFAULT AS IDENTITY,
    qtnd_qtnm_id int4 NOT NULL,
    qtnd_pol_id int4 NULL,
    qtnd_pol_name varchar(100) NULL,
    qtnd_pod_id int4 NULL,
    qtnd_pod_name varchar(100) NULL,
    qtnd_carrier_id int4 NULL,
    qtnd_carrier_name varchar(100) NULL,
    qtnd_trans_time varchar(15) NULL,
    qtnd_routing varchar(100) NULL,
    qtnd_cntr_type varchar(6) NOT NULL,
    qtnd_etd varchar(25) NOT NULL,
    qtnd_cutoff varchar(25) NOT NULL,
    qtnd_of numeric(15, 3) NULL,
    qtnd_pss numeric(15, 3) NULL,
    qtnd_baf numeric(15, 3) NULL,
    qtnd_isps numeric(15, 3) NULL,
    qtnd_haulage numeric(15, 3) NULL,
    qtnd_ifs numeric(15, 3) NULL,
    qtnd_tot_amt numeric(15, 3) NOT NULL,
    qtnd_order int4 NULL,
    mark_qtnmqtnm_id int4 NULL,
    rec_version int4 DEFAULT 1 NOT NULL,
    rec_locked text NULL,
    rec_created_by varchar(20) NOT NULL,
    rec_created_date timestamptz NOT NULL,
    rec_edited_by varchar(20) NULL,
    rec_edited_date timestamptz NULL,
    rec_company_id int4 NOT NULL,
    rec_branch_id int4 NOT NULL,
    CONSTRAINT pk_mark_qtnd_fcl_qtnd_id PRIMARY KEY (qtnd_id),
    CONSTRAINT fk_mark_qtnd_fcl_rec_company_id FOREIGN KEY (rec_company_id) REFERENCES mast_companym(comp_id),
    CONSTRAINT fk_mark_qtnd_fcl_rec_branch_id FOREIGN KEY (rec_branch_id) REFERENCES mast_branchm(branch_id),
    CONSTRAINT fk_mark_qtnd_fcl_qtnd_qtnm_id FOREIGN KEY (qtnd_qtnm_id) REFERENCES mark_qtnm(qtnm_id),
    CONSTRAINT fk_mark_qtnd_fcl_qtnd_pol_id FOREIGN KEY (qtnd_pol_id) REFERENCES mast_param(param_id),
    CONSTRAINT fk_mark_qtnd_fcl_qtnd_pod_id FOREIGN KEY (qtnd_pod_id) REFERENCES mast_param(param_id),
    CONSTRAINT fk_mark_qtnd_fcl_qtnd_carrier_id FOREIGN KEY (qtnd_carrier_id) REFERENCES mast_param(param_id),
    CONSTRAINT "FK_mark_qtnd_fcl_mark_qtnm_mark_qtnmqtnm_id" FOREIGN KEY (mark_qtnmqtnm_id) REFERENCES mark_qtnm(qtnm_id)
);


DO $$
BEGIN

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_mark_qtnd_fcl_mark_qtnmqtnm_id') THEN
        CREATE INDEX "IX_mark_qtnd_fcl_mark_qtnmqtnm_id" ON mark_qtnd_fcl USING btree (mark_qtnmqtnm_id);
    END IF;
END $$;

INSERT INTO mark_qtnd_fcl (qtnd_id, qtnd_qtnm_id, qtnd_cntr_type, qtnd_etd, qtnd_cutoff, qtnd_tot_amt, rec_created_by, rec_created_date, rec_company_id, rec_branch_id)
SELECT 2, 3, '40'' ft', 'QF-10', 'ABC', 5000, 'ADMIN', NOW(), 1, 1
WHERE NOT EXISTS (SELECT 1 FROM mark_qtnd_fcl WHERE qtnd_id = 2);

SELECT setval(pg_get_serial_sequence('mark_qtnd_fcl', 'qtnd_id'), 
              COALESCE(MAX(qtnd_id), 1), 
              true) 
FROM mark_qtnd_fcl;
