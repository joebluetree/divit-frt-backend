CREATE TABLE IF NOT EXISTS cargo_followup (
    cf_id int4 GENERATED BY DEFAULT AS IDENTITY,
    cf_mbl_id int4 NOT NULL,
    cf_user_id int4 NOT NULL,
    cf_remarks TEXT NULL,
    cf_followup_date date NULL,
    cf_assigned_id int4 NOT NULL,

    rec_version int4 DEFAULT 1 NOT NULL,
    rec_locked VARCHAR(50) NULL,
    rec_created_by VARCHAR(50) NULL,
    rec_created_date timestamptz NOT NULL,
    rec_edited_by VARCHAR(50) NULL,
    rec_edited_date timestamptz NULL,
    rec_company_id int4 NOT NULL,
    rec_branch_id int4 NOT NULL,
    CONSTRAINT pk_cargo_followup_cf_id PRIMARY KEY (cf_id)
    
);

DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_followup_cf_mbl_id') THEN
        CREATE INDEX "IX_cargo_followup_cf_mbl_id" ON cargo_followup USING btree (cf_mbl_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_followup_cf_user_id') THEN
        CREATE INDEX "IX_cargo_followup_cf_user_id" ON cargo_followup USING btree (cf_user_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_followup_cf_assigned_id') THEN
        CREATE INDEX "IX_cargo_followup_cf_assigned_id" ON cargo_followup USING btree (cf_assigned_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_followup_rec_company_id') THEN
        CREATE INDEX "IX_cargo_followup_rec_company_id" ON cargo_followup USING btree (rec_company_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_followup_rec_branch_id') THEN
        CREATE INDEX "IX_cargo_followup_rec_branch_id" ON cargo_followup USING btree (rec_branch_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('cargo_followup', 'cf_id'),
              COALESCE(MAX(cf_id), 1),
              true)
FROM cargo_followup;
