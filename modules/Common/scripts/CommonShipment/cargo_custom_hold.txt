CREATE TABLE IF NOT EXISTS cargo_custom_hold (
    custom_id int4 GENERATED BY DEFAULT AS IDENTITY,
    custom_parent_id int4 NOT NULL,
    custom_refno VARCHAR(60) NULL,
    custom_houseno VARCHAR(30) NULL,
    custom_title VARCHAR(100) NULL,
    custom_comm_inv_yn VARCHAR(1) NULL,
    custom_fumi_cert_yn VARCHAR(1) NULL,
    custom_insp_chrg_yn VARCHAR(1) NULL,
    custom_comm_inv VARCHAR(250) NULL,
    custom_fumi_cert VARCHAR(250) NULL,
    custom_insp_chrg VARCHAR(250) NULL,
    custom_remarks VARCHAR(250) NULL,

    rec_company_id int4 NOT NULL,
    rec_branch_id int4 NOT NULL,
    rec_created_by VARCHAR(50) NOT NULL,
    rec_created_date timestamptz NOT NULL,
    rec_edited_by VARCHAR(50) NULL,
    rec_edited_date timestamptz NULL,
    rec_locked VARCHAR(50) NULL,
    rec_version int4 DEFAULT 1 NULL,

    CONSTRAINT pk_cargo_custom_hold_custom_id PRIMARY KEY (custom_id)
);

DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_custom_hold_custom_parent_id') THEN
        CREATE INDEX "IX_cargo_custom_hold_custom_parent_id" ON cargo_custom_hold USING btree (custom_parent_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_custom_hold_rec_company_id') THEN
        CREATE INDEX "IX_cargo_custom_hold_rec_company_id" ON cargo_custom_hold USING btree (rec_company_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_custom_hold_rec_branch_id') THEN
        CREATE INDEX "IX_cargo_custom_hold_rec_branch_id" ON cargo_custom_hold USING btree (rec_branch_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('cargo_custom_hold', 'custom_id'),
              COALESCE(MAX(custom_id), 1),
              true)
FROM cargo_custom_hold;
