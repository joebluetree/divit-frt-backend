CREATE TABLE IF NOT EXISTS cargo_memo (
    memo_id int4 GENERATED BY DEFAULT AS IDENTITY,
    memo_parent_id int4 NOT NULL,
    memo_parent_type VARCHAR(50) NULL,
    memo_remarks_id int4 NULL,
    memo_remarks_name VARCHAR(200) NULL,
    memo_date timestamptz NULL,
    memo_memo  VARCHAR(50) NULL,
    rec_files_attached VARCHAR(10) NULL,
    
    rec_company_id int4 NOT NULL,
    rec_branch_id int4 NOT NULL,
    rec_created_by VARCHAR(50) NOT NULL,
    rec_created_date timestamptz NOT NULL,
    rec_edited_by VARCHAR(50) NULL,
    rec_edited_date timestamptz NULL,
    rec_locked VARCHAR(50) NULL,
    rec_version int4 DEFAULT 1 NULL,
    CONSTRAINT pk_cargo_memo_memo_id PRIMARY KEY (memo_id)
);

DO $$
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_memo_memo_remarks_id') THEN
        CREATE INDEX "IX_cargo_memo_memo_remarks_id" ON cargo_memo USING btree (memo_remarks_id);
    END IF;
    
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_memo_rec_company_id') THEN
        CREATE INDEX "IX_cargo_memo_rec_company_id" ON cargo_memo USING btree (rec_company_id);
    END IF;
    
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_cargo_memo_rec_branch_id') THEN
        CREATE INDEX "IX_cargo_memo_rec_branch_id" ON cargo_memo USING btree (rec_branch_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('cargo_memo', 'memo_id'),
              COALESCE(MAX(memo_id), 1),
              true)
FROM cargo_memo;