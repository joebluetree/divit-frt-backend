CREATE TABLE IF NOT EXISTS acc_acctm (
	acc_id int4 GENERATED BY DEFAULT AS IDENTITY,
	acc_code varchar(15) NOT NULL,
	acc_short_name varchar(15) NOT NULL,
	acc_name varchar(100) NOT NULL,
	acc_type varchar(100) NOT NULL,
	acc_row_type varchar(10) NOT NULL,
	acc_maincode_id int4 NULL,
	acc_grp_id int4 NOT NULL,
	rec_version int4 DEFAULT 1 NOT NULL,
	rec_locked bpchar(1) DEFAULT 'N'::bpchar NOT NULL,
	rec_created_by varchar(20) NOT NULL,
	rec_created_date timestamptz NOT NULL,
	rec_edited_by varchar(20) NULL,
	rec_edited_date timestamptz NULL,
	rec_company_id int4 NOT NULL,
	CONSTRAINT pk_acc_acctm_acc_id PRIMARY KEY (acc_id)
);

DO $$  
BEGIN
	IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_acctm_acc_grp_id') THEN  
		CREATE INDEX "IX_acc_acctm_acc_grp_id" ON acc_acctm USING btree (acc_grp_id);
	END IF; 

	IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_acctm_acc_maincode_id') THEN  
		CREATE INDEX "IX_acc_acctm_acc_maincode_id" ON acc_acctm USING btree (acc_maincode_id);
	END IF;  

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'uq_acc_acctm_acc_code') THEN
		CREATE UNIQUE INDEX uq_acc_acctm_acc_code ON acc_acctm USING btree (rec_company_id, acc_row_type, acc_code);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'uq_acc_acctm_acc_name') THEN
		CREATE UNIQUE INDEX uq_acc_acctm_acc_name ON acc_acctm USING btree (rec_company_id, acc_row_type, acc_name);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'uq_acc_acctm_acc_short_name') THEN
		CREATE UNIQUE INDEX uq_acc_acctm_acc_short_name ON acc_acctm USING btree (rec_company_id, acc_row_type, acc_short_name);
    END IF;

END $$;

INSERT INTO acc_acctm
(acc_id, acc_code, acc_short_name, acc_name, acc_type, acc_row_type, acc_maincode_id, acc_grp_id, rec_locked, rec_created_by, rec_created_date, rec_company_id)
SELECT 1, 'OI', 'OI', 'OCEAN IMPORT', 'NA', 'MAIN-CODE', NULL, 1, 'N', 'ADMIN', now(), 1
WHERE NOT EXISTS (SELECT 1 FROM acc_acctm WHERE acc_id = 1);

INSERT INTO acc_acctm
(acc_id, acc_code, acc_short_name, acc_name, acc_type, acc_row_type, acc_maincode_id, acc_grp_id, rec_locked, rec_created_by, rec_created_date, rec_company_id)
SELECT 2, 'OE', 'OE', 'OCEAN EXPORT', 'NA', 'MAIN-CODE', NULL, 1, 'N', 'ADMIN', now(), 1
WHERE NOT EXISTS (SELECT 1 FROM acc_acctm WHERE acc_id = 2);

SELECT setval(pg_get_serial_sequence('acc_acctm', 'acc_id'), 
              COALESCE(MAX(acc_id), 1), 
              true) 
FROM acc_acctm;