CREATE TABLE IF NOT EXISTS acc_invoicem (
	inv_id int4 GENERATED BY DEFAULT AS IDENTITY,
	inv_cfno int4 NOT NULL,
	inv_no varchar(30) NULL,
	inv_date date NULL,
	inv_cust_id int4 NULL,
	inv_cust_name varchar(100) NULL,
	inv_mbl_refno varchar(30) NULL,
	inv_arrnotice varchar(10) NULL,
	inv_cust_refno varchar(30) NULL,
	inv_quoteno varchar(30) NULL,

	inv_houseno varchar(60) NULL ,
	inv_shipper varchar(100) NULL,
	inv_consignee varchar(100) NULL,
	inv_pcs int4 NULL,
	inv_uom_id int4 NULL,
	inv_lbs numeric(15, 3) NULL,
	inv_kgs numeric(15, 3) NULL,
	inv_cbm numeric(15, 3) NULL,
	inv_cft numeric(15, 3) NULL,
	rec_deleted varchar(1) NULL,
	inv_ftotal numeric(15, 3) NULL,
	inv_cur_id int4 NULL,
	inv_exrate numeric(15, 7) NULL,
	inv_total numeric(15, 3) NULL,
	inv_paid numeric(15, 3) NULL,
	inv_remarks1 varchar(60) NULL,
	inv_remarks2 varchar(60) NULL,
	inv_remarks3 varchar(60) NULL,

	inv_cost_type varchar(10) NULL,
	inv_arap varchar(10) NULL,
	inv_type varchar(10) NULL,
	inv_mbl_id int4 NULL,
	inv_hbl_id int4 NULL,
	rec_files_attached varchar(1) NULL,
	rec_files_count int4 NULL,
	rec_check_attached varchar(1) NULL,
	rec_check_count int4 NULL,
	
	rec_version int4 DEFAULT 1 NOT NULL,
	rec_locked bpchar(1) DEFAULT 'N'::bpchar NOT NULL,
	rec_created_by varchar(20) NOT NULL,
	rec_created_date timestamptz NOT NULL,
	rec_edited_by varchar(20) NULL,
	rec_edited_date timestamptz NULL,
	rec_company_id int4 NOT NULL,
	rec_branch_id int4 NOT NULL,
	CONSTRAINT pk_acc_invoicem_inv_id PRIMARY KEY (inv_id),
	CONSTRAINT fk_acc_invoicem_rec_company_id FOREIGN KEY (rec_company_id) REFERENCES mast_companym(comp_id),
    CONSTRAINT fk_acc_invoicem_rec_branch_id FOREIGN KEY (rec_branch_id) REFERENCES mast_branchm(branch_id),
    CONSTRAINT fk_acc_invoicem_inv_cust_id FOREIGN KEY (inv_cust_id) REFERENCES mast_customerm(cust_id),
    CONSTRAINT fk_acc_invoicem_inv_cur_id FOREIGN KEY (inv_cur_id) REFERENCES mast_param(param_id)
);

DO $$  
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'IX_acc_invoicem_inv_cust_id') THEN
		CREATE INDEX "IX_acc_invoicem_inv_cust_id" ON acc_invoicem USING btree (inv_cust_id);
    END IF;

	IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'IX_acc_invoicem_inv_cur_id') THEN
		CREATE INDEX "IX_acc_invoicem_inv_cur_id" ON acc_invoicem USING btree (inv_cur_id);
    END IF;
	
	IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'IX_acc_invoicem_inv_uom_id') THEN
		CREATE INDEX "IX_acc_invoicem_inv_uom_id" ON acc_invoicem USING btree (inv_uom_id);
    END IF;
	
	IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'IX_acc_invoicem_inv_mbl_id') THEN
		CREATE INDEX "IX_acc_invoicem_inv_mbl_id" ON acc_invoicem USING btree (inv_mbl_id);
    END IF;
	
	IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE  indexname = 'IX_acc_invoicem_inv_hbl_id') THEN
		CREATE INDEX "IX_acc_invoicem_inv_hbl_id" ON acc_invoicem USING btree (inv_hbl_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_invoicem_rec_branch_id') THEN
        CREATE INDEX "IX_acc_invoicem_rec_branch_id" ON acc_invoicem USING btree (rec_branch_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_invoicem_rec_company_id') THEN
        CREATE INDEX "IX_acc_invoicem_rec_company_id" ON acc_invoicem USING btree (rec_company_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('acc_invoicem', 'inv_id'), 
              COALESCE(MAX(inv_id), 1), 
              true) 
FROM acc_invoicem;