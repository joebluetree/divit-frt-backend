CREATE TABLE IF NOT EXISTS acc_ledgerh (
	jvh_id int4 GENERATED BY DEFAULT AS IDENTITY,
	jvh_year int4 NOT NULL,
	jvh_vrno int4 NOT NULL,
	jvh_docno varchar(30) NULL,
	jvh_type varchar(15) NULL,
	jvh_date date NULL,
	jvh_refno varchar(30) NULL,
	jvh_refdate date NULL,
	jvh_status varchar(30) NULL,
	jvh_cur_id int4 NULL,
	jvh_exrate numeric(15,7) NULL,
	jvh_remarks varchar(100) NULL,
	jvh_narration varchar(200) NULL,
	jvh_master_date date NULL,
	jvh_is_payroll varchar(5) NULL ,
	jvh_shipment_ref varchar(60) NULL,
	jvh_shipment_date date NULL,
	jvh_debit numeric(15,3) NULL,
	jvh_credit numeric(15,3) NULL,

	rec_version int4 DEFAULT 1 NOT NULL,
	rec_locked bpchar(1) DEFAULT 'N'::bpchar NOT NULL,
	rec_created_by varchar(20) NOT NULL,
	rec_created_date timestamptz NOT NULL,
	rec_edited_by varchar(20) NULL,
	rec_edited_date timestamptz NULL,
	rec_company_id int4 NOT NULL,
	rec_branch_id int4 NOT NULL,
	CONSTRAINT pk_acc_ledgerh_jvh_id PRIMARY KEY (jvh_id),
	CONSTRAINT fk_acc_ledgerh_jvh_cur_id FOREIGN KEY (jvh_cur_id) REFERENCES mast_param(param_id),
	CONSTRAINT fk_acc_ledgerh_rec_company_id FOREIGN KEY (rec_company_id) REFERENCES mast_companym(comp_id),
    CONSTRAINT fk_acc_ledgerh_rec_branch_id FOREIGN KEY (rec_branch_id) REFERENCES mast_branchm(branch_id)
);

DO $$  
BEGIN
	IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_ledgerh_jvh_cur_id') THEN
        CREATE INDEX "IX_acc_ledgerh_jvh_cur_id" ON acc_ledgerh USING btree (jvh_cur_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_ledgerh_rec_branch_id') THEN
        CREATE INDEX "IX_acc_ledgerh_rec_branch_id" ON acc_ledgerh USING btree (rec_branch_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_ledgerh_rec_company_id') THEN
        CREATE INDEX "IX_acc_ledgerh_rec_company_id" ON acc_ledgerh USING btree (rec_company_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('acc_ledgerh', 'jvh_id'), 
              COALESCE(MAX(jvh_id), 1), 
              true) 
FROM acc_ledgerh;