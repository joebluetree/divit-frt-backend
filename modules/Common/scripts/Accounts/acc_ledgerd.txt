CREATE TABLE IF NOT EXISTS acc_ledgerd (
	jv_id int4 GENERATED BY DEFAULT AS IDENTITY,
	jv_header_id int4 NULL,
	jv_year int4 NOT NULL,
	jv_vrno int4 NOT NULL,
	jv_docno varchar(30) NULL,
	jv_type varchar(15) NULL,
	jv_date date NULL,
	jv_refno varchar(30) NULL,
	jv_refdate date NULL,
	jv_acc_id int4 NULL,
	jv_status varchar(50) NULL,
	jv_shipment_ref varchar(60) NULL,
	jv_shipment_date date NULL,
	jv_famt numeric(15,3) NULL,
	jv_cur_id int4 NULL,
	jv_exrate numeric(15,7) NULL,
	jv_drcr varchar(5) NULL,
	jv_dcamt numeric(15,3) NULL,
	jv_debit numeric(15,3) NULL,	
	jv_credit numeric(15,3) NULL,
	jv_inv_id int4 NULL,
	jv_remarks varchar(100) NULL,
	jv_narration varchar(200) NULL,
	jv_doc_type varchar(30) NULL,
	jv_bank	varchar(60) NULL,
	jv_chqno varchar(30) NULL,
	jv_chq_date date NULL,
	jv_master_date date NULL,
	jv_is_payroll varchar(5) NULL ,
	jv_tax_amt numeric(15,3) NULL,
	jv_tax_per numeric(15,3) NULL,
	jv_ctr int4 NULL,

	rec_version int4 DEFAULT 1 NOT NULL,
	rec_locked bpchar(1) DEFAULT 'N'::bpchar NOT NULL,
	rec_created_by varchar(20) NOT NULL,
	rec_created_date timestamptz NOT NULL,
	rec_edited_by varchar(20) NULL,
	rec_edited_date timestamptz NULL,
	rec_company_id int4 NOT NULL,
	rec_branch_id int4 NOT NULL,

	CONSTRAINT pk_acc_ledgerd_jv_id PRIMARY KEY (jv_id),
	CONSTRAINT fk_acc_ledgerd_jv_header_id FOREIGN KEY (jv_header_id) REFERENCES acc_ledgerh(jvh_id),
	CONSTRAINT fk_acc_ledgerd_jv_cur_id FOREIGN KEY (jv_cur_id) REFERENCES mast_param(param_id),
	CONSTRAINT fk_acc_ledgerd_rec_branch_id FOREIGN KEY (rec_branch_id) REFERENCES mast_branchm(branch_id),
	CONSTRAINT fk_acc_ledgerd_rec_company_id FOREIGN KEY (rec_company_id) REFERENCES mast_companym(comp_id)
);

DO $$  
BEGIN
    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_ledgerd_jv_header_id') THEN
        CREATE INDEX "IX_acc_ledgerd_jv_header_id" ON acc_ledgerd USING btree (jv_header_id);
    END IF;

	IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_ledgerd_jv_cur_id') THEN
        CREATE INDEX "IX_acc_ledgerd_jv_cur_id" ON acc_ledgerd USING btree (jv_cur_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_ledgerd_rec_branch_id') THEN
        CREATE INDEX "IX_acc_ledgerd_rec_branch_id" ON acc_ledgerd USING btree (rec_branch_id);
    END IF;

    IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE indexname = 'IX_acc_ledgerd_rec_company_id') THEN
        CREATE INDEX "IX_acc_ledgerd_rec_company_id" ON acc_ledgerd USING btree (rec_company_id);
    END IF;
END $$;

SELECT setval(pg_get_serial_sequence('acc_ledgerd', 'jv_id'), 
              COALESCE(MAX(jv_id), 1), 
              true) 
FROM acc_ledgerd;